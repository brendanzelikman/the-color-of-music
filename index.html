<html>
  <head>
    <title>3D Piano Player (Three.js)</title>
    <script src="js/three.js"></script>

    <script src="js/OrbitAndPanControls.js"></script>
    <script src="js/ColladaLoader.js"></script>
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.7.58/Tone.js"
      integrity="sha512-QhmI/idBFIq3hd9NsBFF8y6i5ziFjZP1bea5/J7piTjn6duaZ1LPsFuo26nTXeE1l98vOtXdNkHSzxVDmqVneg=="
      crossorigin="anonymous"
    ></script>

    <!-- extras -->
    <script src="js/base64binary.js" type="text/javascript"></script>

    <script src="js/MIDI/AudioDetect.js" type="text/javascript"></script>
    <script src="js/MIDI/LoadPlugin.js" type="text/javascript"></script>
    <script src="js/MIDI/Plugin.js" type="text/javascript"></script>
    <script src="js/MIDI/Player.js" type="text/javascript"></script>
    <script src="js/MIDI/Loader.js" type="text/javascript"></script>

    <script src="js/Window/DOMLoader.script.js" type="text/javascript"></script>

    <!-- jasmid package -->
    <script src="js/jasmid/stream.js"></script>
    <script src="js/jasmid/midifile.js"></script>
    <script src="js/jasmid/replayer.js"></script>

    <script type="text/javascript" src="js/dat.gui.js"></script>

    <style>
      canvas {
        width: 100%;
        height: 100%;
      }
      body {
        color: rgb(0, 0, 0);
        font-family: Monospace;
        font-size: 13px;
        text-align: center;

        background-color: #fff;
        margin: 0px;
        overflow: hidden;
      }

      #info {
        position: absolute;
        top: 0px;
        width: 100%;
        padding: 5px;
      }

      a {
        color: #1e83ff;
      }
    </style>
  </head>
  <body>
    <script type="text/javascript">
      // Begin MIDI loader widger
      MIDI.loader = new widgets.Loader({
        message: "Loading: Soundfont...",
      });
      function smoothstep(a, b, x) {
        if (x < a) return 0.0;
        if (x > b) return 1.0;
        var y = (x - a) / (b - a);
        return y * y * (3.0 - 2.0 * y);
      }
      function mix(a, b, x) {
        return a + (b - a) * Math.min(Math.max(x, 0.0), 1.0);
      }

      var piano = new Tone.Sampler({
        urls: {
          C2: "C2.mp3",
          Db2: "Db2.mp3",
          D2: "D2.mp3",
          Eb2: "Eb2.mp3",
          E2: "E2.mp3",
          F2: "F2.mp3",
          Gb2: "Gb2.mp3",
          G2: "G2.mp3",
          Ab2: "Ab2.mp3",
          A2: "A2.mp3",
          Bb2: "Bb2.mp3",
          B2: "B2.mp3",
          C3: "C3.mp3",
          Db3: "Db3.mp3",
          D3: "D3.mp3",
          Eb3: "Eb3.mp3",
          E3: "E3.mp3",
          F3: "F3.mp3",
          Gb3: "Gb3.mp3",
          G3: "G3.mp3",
          Ab3: "Ab3.mp3",
          A3: "A3.mp3",
          Bb3: "Bb3.mp3",
          B3: "B3.mp3",
          C4: "C4.mp3",
          Db4: "Db4.mp3",
          D4: "D4.mp3",
          Eb4: "Eb4.mp3",
          E4: "E4.mp3",
          F4: "F4.mp3",
          Gb4: "Gb4.mp3",
          G4: "G4.mp3",
          Ab4: "Ab4.mp3",
          A4: "A4.mp3",
          Bb4: "Bb4.mp3",
          B4: "B4.mp3",
          C5: "C5.mp3",
          Db5: "Db5.mp3",
          D5: "D5.mp3",
          Eb5: "Eb5.mp3",
          E5: "E5.mp3",
          F5: "F5.mp3",
          Gb5: "Gb5.mp3",
          G5: "G5.mp3",
          Ab5: "Ab5.mp3",
          A5: "A5.mp3",
          Bb5: "Bb5.mp3",
          B5: "B5.mp3",
        },
        baseUrl: "soundfont/acoustic_grand_piano-mp3/",
        onload: () => {
          console.log("Loaded piano!");
        },
      });

      var tone = piano;

      var chorus = new Tone.Chorus(0.001).start();
      chorus.wet.value = 0;

      var reverb = new Tone.Reverb(1);
      reverb.wet.value = 0;

      var phaser = new Tone.Phaser(0.001);
      phaser.wet.value = 0;

      var vibrato = new Tone.Vibrato(0.001);
      vibrato.wet.value = 0;

      var volume = new Tone.Volume(0);

      const initializeEffects = () => {
        tone.chain(reverb, chorus, phaser, vibrato, volume, Tone.Master);
      };
      initializeEffects();

      var timeSinceChange = 0;
      var colorSum = new THREE.Color();

      var controls = new (function () {
        this.key_attack_time = 9.0;
        this.key_max_rotation = 0.72;
        // Sound Settings
        this.instrument = "grandpiano";
        this.sustain = false;
        this.octave = 2;
        this.volume = 100;
        // Sound Effects
        this.reverbAmount = 0;
        this.chorusAmount = 0;
        this.phaserAmount = 0;
        this.vibratoAmount = 0;
        // Color Effects
        this.colorize = true;
        this.colorDelay = 0;
        this.map = "scriabin";
        // MIDI Settings
        this.song = "game_of_thrones.mid";
        this.mode = "lerp";
        this.play = function () {
          MIDI.Player.resume();
        };
        this.stop = function () {
          MIDI.Player.stop();
        };
      })();

      var keyState = Object.freeze({
        unpressed: {},
        note_on: {},
        pressed: {},
        note_off: {},
      });

      var scene = new THREE.Scene();
      var camera = new THREE.PerspectiveCamera(
        30,
        window.innerWidth / window.innerHeight,
        2.0,
        5000
      );

      var keys_down = [];
      var notes_down = [];
      var keys_obj = [];

      var renderer = new THREE.WebGLRenderer({ antialias: true });
      renderer.setSize(window.innerWidth, window.innerHeight);
      renderer.shadowMapEnabled = true;
      renderer.shadowMapSoft = true;
      renderer.shadowMapType = THREE.PCFSoftShadowMap;
      renderer.gammaInput = true;
      renderer.gammaOutput = true;
      renderer.physicallyBasedShading = true;

      document.body.appendChild(renderer.domElement);

      var material = new THREE.MeshLambertMaterial({ color: 0x606060 });
      document.body.style.background = "#000";

      // Create spotlight
      function createSpotlight(color) {
        const newObj = new THREE.SpotLight(color, 2);
        newObj.castShadow = true;
        newObj.angle = 0.3;
        newObj.penumbra = 0.2;
        newObj.decay = 2;
        newObj.distance = 50;
        return newObj;
      }

      // Get a random element from array
      function get_random_elem(list) {
        return list[Math.floor(Math.random() * list.length)];
      }

      // Get random float
      function getRandomArbitrary(min, max) {
        return Math.random() * (max - min) + min;
      }

      // Change background color based on key pressed
      function changeBackgroundColor(note) {
        const hexcode = keyCode_to_color(note - 21);
        // Single color
        document.body.style.background = "";
        document.body.style.backgroundColor = hexcode;

        // Multiple colors
        if (Object.keys(keys_down).length > 1) {
          let gradient = get_random_elem([
            "radial-gradient(circle, ",
            "conic-gradient(",
          ]);
          let firstColor = [Object.keys(keys_down)[0], false];
          if (gradient == "conic-gradient(") {
            firstColor[1] = true;
          }

          for (let key in keys_down) {
            const note = keyCode_to_note(key).substring(1);
            const color = keyCode_to_color(note);
            gradient += `${color},`;
          }

          if (firstColor[1]) {
            const note = keyCode_to_note(firstColor[0]).substring(1);
            const color = keyCode_to_color(note);
            gradient += `${color},`;
          }
          gradient = gradient.slice(0, -1) + ")";

          document.body.style.background = gradient;
        }
      }

      document.addEventListener(
        "keyup",
        (event) => {
          delete keysPressed[event.key];
          for (let spotlight of spotLights) {
            scene.remove(spotlight);
            spotLights.splice(spotLights.indexOf(spotlight), 1);
          }
        },
        false
      );

      scene.fog = new THREE.Fog(0xffffff, 40, 50);

      init_lights();

      var loader = new THREE.ColladaLoader();

      loader.load("obj/piano.dae", prepare_scene);

      camera.position.set(6, 3, 10);
      camera.lookAt(new THREE.Vector3(0, 0, 0));

      var cameraControls = new THREE.OrbitAndPanControls(
        camera,
        renderer.domElement
      );
      // cameraControls.target.set(4.5, 0, 0);

      var clock = new THREE.Clock();

      function on_window_resize() {
        camera.aspect = window.innerWidth / window.innerHeight;
        camera.updateProjectionMatrix();

        renderer.setSize(window.innerWidth, window.innerHeight);
      }

      function init_lights() {
        //var spotlight = new THREE.SpotLight(0xffffff);
        var spotlight = new THREE.DirectionalLight(0xffffff);

        spotlight.position.set(1.0, 2.4, -7.5);
        spotlight.target.position.set(6.0, -6, 7);
        spotlight.shadowCameraVisible = false;
        spotlight.shadowDarkness = 0.75;
        spotlight.intensity = 1;
        spotlight.castShadow = true;
        spotlight.shadowMapWidth = 2048;
        spotlight.shadowMapHeight = 2048;

        spotlight.shadowCameraNear = 5.0;
        spotlight.shadowCameraFar = 20.0;
        spotlight.shadowBias = 0.0025;

        spotlight.shadowCameraLeft = -8.85;
        spotlight.shadowCameraRight = 5.5;
        spotlight.shadowCameraTop = 4;
        spotlight.shadowCameraBottom = 0;
        scene.add(spotlight);
        var light = new THREE.DirectionalLight(0xddffff, 0.5);
        light.position.set(1, 1, 1).normalize();
        scene.add(light);

        var light = new THREE.DirectionalLight(0xff5555, 0.5);
        light.position.set(-1, -1, -1).normalize();
        scene.add(light);
      }

      function prepare_scene(collada) {
        collada.scene.traverse(initialize_keys);
        scene.add(collada.scene);
      }

      function initialize_keys(obj) {
        keys_obj.push(obj);
        obj.rotation.x = -Math.PI / 4.0;
        obj.rotation.y = 0;
        obj.rotation.z = 0;

        obj.keyState = keyState.unpressed;
        obj.clock = new THREE.Clock(false);
        obj.castShadow = true;
        obj.receiveShadow = true;

        // only add meshes in the material redefinition (to make keys change their color when pressed)
        if (obj instanceof THREE.Mesh) {
          old_material = obj.material;
          obj.material = new THREE.MeshPhongMaterial({
            color: old_material.color,
          });
          obj.material.shininess = 35.0;
          obj.material.specular = new THREE.Color().setRGB(0.25, 0.25, 0.25);
          obj.material.note_off = obj.material.color.clone();
        }
      }

      function key_status(keyName, status) {
        var obj = scene.getObjectByName(keyName, true);
        if (obj != undefined) {
          obj.clock.start();
          obj.clock.elapsedTime = 0;
          obj.keyState = status;
        }
      }

      function frame() {
        requestAnimationFrame(frame);

        var delta = clock.getDelta();

        update(delta);
        render(delta);
      }
      function update_key(obj, delta) {
        if (obj.keyState == keyState.note_on) {
          obj.rotation.x = mix(
            -Math.PI / 4.0,
            -controls.key_max_rotation,
            smoothstep(
              0.0,
              1.0,
              controls.key_attack_time * obj.clock.getElapsedTime()
            )
          );
          if (obj.rotation.x >= -controls.key_max_rotation) {
            obj.keyState = keyState.pressed;
            obj.clock.elapsedTime = 0;
          }
          if (controls.colorize) {
            const note = parseInt(obj.name.substring(1));
            const hexcode = keyCode_to_color(note);
            const color = new THREE.Color(hexcode);
            obj.material.color = color;
            changeBackgroundColor(note + 21);
            changeSpotlight(note + 21);
          }
        } else if (obj.keyState == keyState.note_off) {
          obj.rotation.x = mix(
            -controls.key_max_rotation,
            -Math.PI / 4.0,
            smoothstep(
              0.0,
              1.0,
              controls.key_attack_time * obj.clock.getElapsedTime()
            )
          );
          if (obj.rotation.x <= -Math.PI / 4.0) {
            obj.keyState = keyState.unpressed;
            obj.clock.elapsedTime = 0;
          }
          obj.material.color = obj.material.note_off;
        }
      }

      function update(delta) {
        timeSinceChange += delta;
        cameraControls.update(delta);
        for (i in keys_obj) {
          update_key(keys_obj[i], delta);
        }
      }

      function render(delta) {
        renderer.render(scene, camera);
      }

      frame();

      function keyCode_to_note(keyCode) {
        var note = -1;
        //-----------------------------------
        if (keyCode == 90) note = 0; // C 0
        if (keyCode == 83) note = 1; // C#0
        if (keyCode == 88) note = 2; // D 0
        if (keyCode == 68) note = 3; // D#0
        if (keyCode == 67) note = 4; // E 0
        if (keyCode == 86) note = 5; // F 0
        if (keyCode == 71) note = 6; // F#0
        if (keyCode == 66) note = 7; // G 0
        if (keyCode == 72) note = 8; // G#0
        if (keyCode == 78) note = 9; // A 0
        if (keyCode == 74) note = 10; // A#0
        if (keyCode == 77) note = 11; // B 0
        if (keyCode == 188) note = 12; // C 0

        //-----------------------------------
        if (keyCode == 81) note = 12; // C 1
        if (keyCode == 50) note = 13; // C#1
        if (keyCode == 87) note = 14; // D 1
        if (keyCode == 51) note = 15; // D#1
        if (keyCode == 69) note = 16; // E 1
        if (keyCode == 82) note = 17; // F 1
        if (keyCode == 53) note = 18; // F#1
        if (keyCode == 84) note = 19; // G 1
        if (keyCode == 54) note = 20; // G#1
        if (keyCode == 89) note = 21; // A 1
        if (keyCode == 55) note = 22; // A#1
        if (keyCode == 85) note = 23; // B 1
        //-----------------------------------
        if (keyCode == 73) note = 24; // C 2
        if (keyCode == 57) note = 25; // C#2
        if (keyCode == 79) note = 26; // D 2
        if (keyCode == 48) note = 27; // D#2
        if (keyCode == 80) note = 28; // E 2
        if (keyCode == 219) note = 29; // F 2
        if (keyCode == 187) note = 30; // F#2
        if (keyCode == 221) note = 31; // G 2
        //-----------------------------------

        if (note == -1) return -1;

        return "_" + (note + controls.octave * 12);
      }
      function keyCode_to_color(note) {
        let colorMap;
        if (controls.map === "scriabin") {
          colorMap = {
            0: "#ff0000", // C
            1: "#ffccff", // C#
            2: "#ffff00", // D
            3: "#9933ff", // D#
            4: "#f0f0f0", // E
            5: "#990000", // F
            6: "#33ffff", // F#
            7: "#ff8000", // G
            8: "#ff00ff", // G#
            9: "#00ff00", // A
            10: "#808080", // Bb
            11: "#0000ff", // B
          };
        }
        if (controls.map === "mars") {
          colorMap = {
            0: "#00ffff", // C
            1: "#ffc0cb", // C#
            2: "#66ff00", // D
            3: "#8f00ff", // D#
            4: "#ffff00", // E
            5: "#007fff", // F
            6: "#ff0000", // F#
            7: "#09feab", // G
            8: "#ff00ff", // G#
            9: "#dfff00", // A
            10: "#93ccea", // Bb
            11: "#e9a447", // B
          };
        }
        if (controls.map === "messiaen") {
          colorMap = {
            0: "#ffffff", // C
            1: "#75816b", // C#
            2: "#00ff00", // D
            3: "#c0428a", // D#
            4: "#ff0000", // E
            5: "#98fb98", // F
            6: "#ffd700", // F#
            7: "#ffff00", // G
            8: "#0f52ba", // G#
            9: "#0000ff", // A
            10: "#997570", // Bb
            11: "#a0522d", // B
          };
        }
        if (controls.map === "primitive") {
          colorMap = {
            0: "#ffff00", // C
            1: "#0024b9", // C#
            2: "#ffa600", // D
            3: "#00b3d6", // D#
            4: "#ff2000", // E
            5: "#85ce00", // F
            6: "#8b21ba", // F#
            7: "#ffcf00", // G
            8: "#007ac7", // G#
            9: "#ff7e00", // A
            10: "#00b901", // Bb
            11: "#f42494", // B
          };
        }
        return colorMap[note % 12];
      }
      let keysPressed = {};

      const pressedKeys = (obj) =>
        Object.keys(obj)
          .filter((x) => !!obj[x])
          .map((x) => parseInt(x));

      // Change spotlight
      let spotLights = [];

      function invertColor(color) {
        return (
          "#" +
          (
            "000000" +
            (0xffffff ^ parseInt(color.substring(1), 16)).toString(16)
          ).slice(-6)
        );
      }
      function changeSpotlight(note) {
        const hexcode = keyCode_to_color(note - 21);
        const invColor = invertColor(hexcode);
        const spotLight = createSpotlight(invColor);

        let x = getRandomArbitrary(-5, 5);
        let y = getRandomArbitrary(-5, 5);
        let z = getRandomArbitrary(-5, 5);

        spotLight.position.set(x, y, z);

        let lightHelper = new THREE.SpotLightHelper(spotLight);

        scene.add(spotLight);
        scene.add(lightHelper);
        // Add to array to remove later
        spotLights.push(spotLight);
        spotLights.push(lightHelper);
      }
      const keysToColors = (keys) => keys.map((x) => keyCode_to_color(x));

      window.onkeydown = function (ev) {
        // changeSpotlight(ev);

        // If key isn't pressed down
        if (keys_down[ev.keyCode] != true) {
          // Convert key to note
          var note = keyCode_to_note(ev.keyCode);
          // If note exists
          if (note != -1) {
            // Update note status
            key_status(note, keyState.note_on);
            keys_down[ev.keyCode] = true;
            // Play note
            var delay = 0; // play one note every quarter second
            var note = parseInt(note.substr(1)) + 21; // the MIDI note
            var velocity = 127; // how hard the note hits
            // Convert note to frequency
            const freq = Tone.Frequency(note, "midi").toFrequency();
            // Trigger attack based on sustain/instrument
            if (!controls.sustain || controls.instrument !== "grandpiano") {
              tone.triggerAttack(freq);
            } else {
              tone.triggerAttackRelease(freq, 2.5 + controls.reverbAmount);
            }
            // Change background color
            // Change key color
            // changeBackgroundColor(note);
          }
        }
      };

      window.onkeyup = function (ev) {
        if (keys_down[ev.keyCode] == true) {
          var note = keyCode_to_note(ev.keyCode);
          key_status(note, keyState.note_off);
          delete keys_down[ev.keyCode];
          // keys_down[ev.keyCode] = false;

          var delay = 0; // play one note every quarter second
          var note = parseInt(note.substr(1)) + 21;
          var velocity = 127; // how hard the note hits
          const freq = Tone.Frequency(note, "midi").toFrequency();
          if (!controls.sustain || controls.instrument !== "grandpiano") {
            tone.triggerRelease(freq);
          }
          // MIDI.setVolume(0, 127);
          // MIDI.noteOff(0, note, delay + 0.08);
        }
      };

      window.onload = function () {
        MIDI.loadPlugin(function () {
          //MIDI.Player.loadFile(song[0], MIDI.Player.start);
          MIDI.Player.timeWarp = 1.0; // speed the song is played back
          MIDI.Player.loadFile("midi/" + controls.song);

          MIDI.Player.addListener(function (data) {
            var pianoKey = data.note - MIDI.pianoKeyOffset - 3;
            if (data.message === 144) {
              key_status("_" + pianoKey, keyState.note_on);
            } else {
              key_status("_" + pianoKey, keyState.note_off);
            }
          });

          // Close the MIDI loader widget and open the GUI
          MIDI.loader.stop();
          var gui = new dat.GUI({ width: 500 });
          // gui.add(controls, "key_attack_time", 2.0, 40.0);
          //gui.add(controls, 'key_max_rotation',0.2 , 1.0);

          const soundFolder = gui.addFolder("Sound Settings");
          soundFolder.open();

          // Add instrument
          var instrument = soundFolder
            .add(controls, "instrument", {
              "Grand Piano": "grandpiano",
              "AM Synth": "amsynth",
              "FM Synth": "fmsynth",
              "Duo Synth": "duosynth",
              "Pluck Synth": "plucksynth",
            })
            .name("Instrument");

          // Reset instrument on change
          instrument.onChange(function (value) {
            tone.releaseAll();
            tone.disconnect();
            if (value === "grandpiano") {
              tone = piano;
            }
            if (value === "amsynth") {
              tone = new Tone.PolySynth(Tone.AMSynth, 6);
            }
            if (value === "fmsynth") {
              tone = new Tone.PolySynth(Tone.FMSynth, 6);
            }
            if (value === "duosynth") {
              tone = new Tone.PolySynth(Tone.DuoSynth, 1);
            }
            if (value === "plucksynth") {
              tone = new Tone.PolySynth(Tone.PluckSynth, 6);
            }
            initializeEffects();
          });

          var shouldSustain = soundFolder
            .add(controls, "sustain")
            .name("Sustain");
          shouldSustain.onChange((value) => {
            tone.releaseAll();
            if (!value && !!controls.reverbAmount) reverbEffect.setValue(0);
          });

          var octave = soundFolder
            .add(controls, "octave", 0, 4)
            .step(1)
            .name("Octave");
          octave.onChange((value) => {
            for (keyCode in keys_down) {
              var note = keyCode_to_note(keyCode);
              key_status(note, keyState.note_off);
            }
          });

          var volumeControl = soundFolder
            .add(controls, "volume", 0, 100)
            .step(1)
            .name("Volume");
          volumeControl.onChange((value) => {
            volume.volume.value = value / 2 - 50;
            volume.mute = !value;
          });

          // Add effect folder
          const effectFolder = gui.addFolder("Sound Effects");
          effectFolder.open();

          // Add reverb effect
          var reverbEffect = effectFolder
            .add(controls, "reverbAmount", 0, 10)
            .step(2)
            .name("Reverb");
          reverbEffect.onChange((value) => {
            if (value > 0) {
              if (!controls.sustain) shouldSustain.setValue(true);
              reverb.decay = controls.reverbAmount;
            }
            reverb.wet.value = !!value ? 1 : 0;
          });

          // Add chorus effect
          var chorusEffect = effectFolder
            .add(controls, "chorusAmount", 0, 5)
            .step(1)
            .name("Chorus");
          chorusEffect.onChange((value) => {
            if (value > 0) {
              chorus.frequency.value = controls.chorusAmount;
            }
            chorus.wet.value = !!value ? 1 : 0;
          });

          // Add phaser effect
          var phaserEffect = effectFolder
            .add(controls, "phaserAmount", 0, 20)
            .step(2)
            .name("Phaser");
          phaserEffect.onChange((value) => {
            if (value > 0) {
              phaser.frequency.value = controls.phaserAmount;
            }
            phaser.wet.value = !!value ? 1 : 0;
          });

          // Add vibrato effect
          var vibratoEffect = effectFolder
            .add(controls, "vibratoAmount", 0, 20)
            .step(2)
            .name("Vibrato");
          vibratoEffect.onChange((value) => {
            if (value > 0) {
              vibrato.frequency.value = controls.vibratoAmount;
            }
            vibrato.wet.value = !!value ? 1 : 0;
          });

          // Add folder for color settings
          const colorFolder = gui.addFolder("Color Settings");
          colorFolder.open();

          var showColor = colorFolder
            .add(controls, "colorize")
            .name("Show Color")
            .onChange(() => {
              // floor.material.color = new THREE.Color(0xffffff);
            });

          var colorDelay = colorFolder
            .add(controls, "colorDelay", 0.0, 2.0)
            .step(0.1)
            .name("Delay Between Colors");

          var map = colorFolder
            .add(controls, "map", {
              "Alexander Scriabin": "scriabin",
              "Olivier Messiaen": "messiaen",
              "Mr. Mars": "mars",
              Primitive: "primitive",
            })
            .name("Color Map");

          var mode = gui
            .add(controls, "mode", {
              "Linear Interpolation": "lerp",
              Gradient: "gradient",
            })
            .name("Color Display");

          // Folder for MIDI controls
          const midiFolder = gui.addFolder("MIDI Settings");
          midiFolder.open();

          // Pick MIDI songs
          var song = midiFolder.add(controls, "song", {
            "Game Of Thrones Theme, Ramin Djawadi": "game_of_thrones.mid",
            "Mario Overworld Theme (Super Mario Bros 3), Koji Kondo":
              "mario_-_overworld_theme.mid",
            "He's a Pirate (Pirates of the Caribbean), Klaus Badelt":
              "hes_a_pirate.mid",
            "Hedwigs Theme (Harry Potter), John Williams": "hedwigs_theme.mid",
            "Something There (Beauty and the Beast), Alan Menken":
              "something_there.mid",
            "Cruel Angel Thesis (Neon Genesis Evangelion)":
              "cruel_angel__s_thesis.mid",
            "Me cuesta tanto olvidarte (Mecano)": "me_cuesta.mid",
            "Sonata No. 14 C# minor (Moonlight), Beethoven": "mond_1.mid",
            "For Elise, Beethoven": "for_elise_by_beethoven.mid",
            "Asturias (Leyenda), Albeniz": "alb_se5_format0.mid",
            "Aragon (Fantasia), Albeniz": "alb_se6.mid",
            "Prelude and Fugue in C major BWV 846, Bach": "bach_846.mid",
            "Fantasia C major, Schubert": "schub_d760_1.mid",
            "Sonata No. 16 C major, Mozart": "mz_545_1.mid",
            "Sonata No. 11 A major (K331, First Movement), Mozart":
              "mz_331_1.mid",
            "March - Song of the Lark, Tchaikovsky": "ty_maerz.mid",
            "Piano Sonata in C major, Hoboken, Haydn": "haydn_35_1.mid",
            "Etudes, Opus 25, Chopin": "chpn_op25_e1.mid",
            "Polonaise Ab major, Opus 53, Chopin": "chpn_op53.mid",
            "No. 2 - Oriental, Granados": "gra_esp_2.mid",
            "Bohemian Rhapsody, Queen": "bohemian1.mid",
          });
          song.onChange(function (value) {
            MIDI.Player.stop();
            MIDI.Player.loadFile("midi/" + value, MIDI.Player.start);
          });
          // Play/stop MIDI songs
          midiFolder.add(controls, "play");
          midiFolder.add(controls, "stop");
        });
      };

      window.addEventListener("resize", on_window_resize, false);
    </script>

    <script type="text/javascript">
      var gaJsHost =
        "https:" == document.location.protocol ? "https://ssl." : "http://www.";
      document.write(
        unescape(
          "%3Cscript src='" +
            gaJsHost +
            "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"
        )
      );
    </script>
    <script type="text/javascript">
      try {
        var pageTracker = _gat._getTracker("UA-302418-4");
        pageTracker._trackPageview();
      } catch (err) {}
    </script>

    <div id="info">
      <a href="http://threejs.org" target="_blank">three.js</a> - 3D Piano
      player demo<br />
      Controls: Keyboard to play, Mouse to orbit<br />
      Uses <a href="http://mudcu.be/midi-js/" target="_blank">MIDI.js</a> Source
      code available on
      <a href="https://github.com/reality3d/3d-piano-player" target="_blank"
        >Github</a
      ><br />
      <a href="http://www.twitter.com/reality3d/" target="_blank"
        >Borja Morales</a
      >
      <a
        href="https://twitter.com/share"
        class="twitter-share-button"
        data-url="http://www.rgba.org/r3d/3d-piano-player/"
        data-via="reality3d"
        >Tweet</a
      >
    </div>
    <script>
      !(function (d, s, id) {
        var js,
          fjs = d.getElementsByTagName(s)[0],
          p = /^http:/.test(d.location) ? "http" : "https";
        if (!d.getElementById(id)) {
          js = d.createElement(s);
          js.id = id;
          js.src = p + "://platform.twitter.com/widgets.js";
          fjs.parentNode.insertBefore(js, fjs);
        }
      })(document, "script", "twitter-wjs");
    </script>
  </body>
</html>
